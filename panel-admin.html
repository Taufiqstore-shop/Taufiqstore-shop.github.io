<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Panel Admin - TaufiqShop</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f0f0f;
  color: #fff;
}
.header {
  padding: 15px;
  background: #111;
  border-bottom: 1px solid #222;
}
.server-info, .orders {
  padding: 15px;
}
.box {
  background: #161616;
  border-radius: 10px;
  padding: 12px;
  margin-bottom: 12px;
}
.order-box {
  border: 1px solid #222;
  border-radius: 8px;
  padding: 10px;
  margin-bottom: 10px;
}
button {
  padding: 6px 10px;
  border: none;
  border-radius: 6px;
  margin-right: 5px;
  cursor: pointer;
  font-size: 13px;
}
button.proses { background: #ca8a04; color: #000; }
button.sukses { background: #16a34a; color: #fff; }
button.gagal { background: #dc2626; color: #fff; }
.status { font-weight: bold; }
.green { color: #22c55e; }
.red { color: #ef4444; }
.yellow { color: #facc15; }
</style>
</head>
<body>
<div class="header">
  <h2>ðŸ›  Panel Admin</h2>
</div>

<div class="server-info box">
  <h3>ðŸ–¥ Informasi Server</h3>
  <p>CPU: <span id="cpu">Loading...</span></p>
  <p>RAM: <span id="ram">Loading...</span> / 17 GB</p>
  <p>Server: <span id="server">Loading...</span></p>
  <p>Region: <span id="region">Loading...</span></p>
  <p>Bot Time: <span id="time">Loading...</span></p>
  <p>Model: <span id="model">Loading...</span></p>
</div>

<div class="orders">
  <h3>ðŸ“¦ Order Masuk</h3>
  <div id="orderList"></div>
</div>

<script type="module">
// ================= FIREBASE IMPORT =================
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import {
  getFirestore,
  collection,
  query,
  orderBy,
  onSnapshot,
  doc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

// ================= CONFIG FIREBASE =================
const firebaseConfig = {
  apiKey: "AIzaSyCmnfh6p5yG5TU98Wmv3ktrnL0NxCaSZZQ",
  authDomain: "databse-c8850.firebaseapp.com",
  projectId: "databse-c8850",
  storageBucket: "databse-c8850.firebasestorage.app",
  messagingSenderId: "768418021481",
  appId: "1:768418021481:web:2d9c93d26cbc518cc962f8"
};

// ================= INIT FIRESTORE =================
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ================= JAM REAL-TIME =================
setInterval(() => {
  document.getElementById("time").innerText = new Date().toLocaleTimeString("id-ID");
}, 1000);

// ================= INFO SERVER REAL-TIME =================
const cpuEl = document.getElementById("cpu");
const ramEl = document.getElementById("ram");
const serverEl = document.getElementById("server");
const regionEl = document.getElementById("region");
const modelEl = document.getElementById("model");

let cpuUsage = Math.floor(Math.random()*10 + 5); // mulai 5-15%
let ramUsage = Math.floor(Math.random()*5 + 3);  // mulai 3-7GB

function updateServer() {
  let change = Math.floor(Math.random()*5 - 2); // CPU naik turun
  cpuUsage += change;
  if(cpuUsage<5) cpuUsage=5;
  if(cpuUsage>45) cpuUsage=45;
  cpuEl.innerText = cpuUsage + "%";

  let rchange = Math.floor(Math.random()*3 -1); // RAM naik turun
  ramUsage += rchange;
  if(ramUsage<3) ramUsage=3;
  if(ramUsage>17) ramUsage=17;
  ramEl.innerText = ramUsage + " GB";

  serverEl.innerText = "Cloudflare";
  regionEl.innerText = "Asia";
  modelEl.innerText = "AMD Ryzen VPS";
}
setInterval(updateServer,2000);

// ================= ORDER REAL-TIME =================
const orderList = document.getElementById("orderList");
const q = query(collection(db,"orders"), orderBy("waktu","desc"));

onSnapshot(q,(snap)=>{
  orderList.innerHTML="";
  if(snap.empty){
    orderList.innerHTML="<p>Belum ada order.</p>";
    return;
  }
  snap.forEach((docSnap)=>{
    const o = docSnap.data();
    let statusClass="yellow";
    if(o.status==="sukses") statusClass="green";
    if(o.status==="gagal") statusClass="red";

    orderList.innerHTML += `
      <div class="order-box">
        <p><b>Game:</b> ${o.game}</p>
        <p><b>ID:</b> ${o.userId}</p>
        <p><b>Diamonds:</b> ${o.diamonds}</p>
        <p><b>Harga:</b> Rp ${o.harga}</p>
        <p><b>Email:</b> ${o.email}</p>
        <p class="status ${statusClass}"><b>Status:</b> ${o.status}</p>

        <button class="proses" onclick="setStatus('${docSnap.id}','proses')">PROSES</button>
        <button class="sukses" onclick="setStatus('${docSnap.id}','sukses')">SUKSES</button>
        <button class="gagal" onclick="setStatus('${docSnap.id}','gagal')">GAGAL</button>
      </div>
    `;
  });
});

// ================= UPDATE STATUS =================
window.setStatus = async(id,status)=>{
  await updateDoc(doc(db,"orders",id),{status:status});
};
</script>

</body>
</html>
